# DR Dashboard Makefile

.PHONY: help build run dev clean test

help: ## Show this help message
	@echo "DR Dashboard - Make targets:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

build: ## Build the application binary
	@echo "ğŸ”¨ Building dr-dashboard..."
	@go build -o dr-dashboard main.go
	@echo "âœ… Build complete: ./dr-dashboard"

run: build ## Build and run the application
	@echo "ğŸš€ Starting DR Dashboard on port 8080..."
	@./dr-dashboard

dev: ## Run in development mode (no build)
	@echo "ğŸš€ Starting DR Dashboard (dev mode)..."
	@go run main.go

clean: ## Clean build artifacts
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@rm -f dr-dashboard dr-dashboard-bin
	@echo "âœ… Clean complete"

test: ## Run Go tests
	@echo "ğŸ§ª Running tests..."
	@go test -v ./...

check: ## Verify scenarios can be loaded
	@echo "ğŸ” Checking disaster scenarios..."
	@test -f ../testing/eks/disaster_scenarios/disaster_scenarios.json || (echo "âŒ EKS scenarios not found"; exit 1)
	@test -f ../testing/on-prem/disaster_scenarios/disaster_scenarios.json || (echo "âŒ On-prem scenarios not found"; exit 1)
	@echo "âœ… All scenario files found"

fmt: ## Format Go code
	@echo "ğŸ¨ Formatting code..."
	@go fmt ./...
	@echo "âœ… Format complete"

lint: ## Lint Go code (requires golangci-lint)
	@echo "ğŸ” Linting code..."
	@golangci-lint run || echo "âš ï¸  Install golangci-lint: https://golangci-lint.run/usage/install/"

deps: ## Download dependencies
	@echo "ğŸ“¦ Downloading dependencies..."
	@go mod download
	@echo "âœ… Dependencies downloaded"

tidy: ## Tidy go.mod
	@echo "ğŸ§¹ Tidying go.mod..."
	@go mod tidy
	@echo "âœ… Tidy complete"
