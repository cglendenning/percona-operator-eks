%% -------------------------------------------------------
%% Percona XtraDB multi-DC (pastel / soft edges / transparent bg)
%% Save as percona-topology.mmd
%% -------------------------------------------------------
%%{init:{
  "theme":"base",
  "themeVariables":{
    "background":"transparent",
    "primaryColor":"#ffffff",
    "primaryBorderColor":"#d8dee4",
    "primaryTextColor":"#2b2b2b",
    "lineColor":"#a8b3c2",
    "fontFamily":"ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial"
  }
}}%%

flowchart TB
  %% Layout
  %% (Mermaid doesn’t round subgraph containers, so we fake it with soft borders & pastel fills)
  linkStyle default stroke:#a8b3c2, stroke-width:1.5px

  %% ======= Data Center A =======
  subgraph DC1["Data Center A — On-prem"]
  direction TB

    subgraph K8S1["Kubernetes Cluster A  ·  <namespace: ___>"]
    direction TB

      OP1["Percona Operator<br/><i>label: ___ · version: ___</i>"]:::operator
      PROXY1["HAProxy / ProxySQL<br/><i>svc: ___</i>"]:::proxy
      SVC1["Service (ClusterIP/LB)<br/><i>dns: ___</i>"]:::svc

      subgraph PXC1["Percona XtraDB Cluster A  ·  <cluster: ___>"]
      direction LR
        P1["PXC-A-1<br/><i>pod: ___</i>"]:::pxc
        P2["PXC-A-2<br/><i>pod: ___</i>"]:::pxc
        P3["PXC-A-3<br/><i>pod: ___</i>"]:::pxc
        P4["PXC-A-4<br/><i>pod: ___</i>"]:::pxc
        P5["PXC-A-5<br/><i>pod: ___</i>"]:::pxc
        P6["PXC-A-6<br/><i>pod: ___</i>"]:::pxc
      end

      STOR1["StorageClass / PV / PVC<br/><i>class: ___</i>"]:::storage
      BK1["PXCBackup / XtraBackup Job<br/><i>schedule: ___</i>"]:::backup
    end
  end

  %% ======= Data Center B =======
  subgraph DC2["Data Center B — On-prem (mirror)"]
  direction TB

    subgraph K8S2["Kubernetes Cluster B  ·  <namespace: ___>"]
    direction TB

      OP2["Percona Operator<br/><i>label: ___ · version: ___</i>"]:::operator
      PROXY2["HAProxy / ProxySQL<br/><i>svc: ___</i>"]:::proxy
      SVC2["Service (ClusterIP/LB)<br/><i>dns: ___</i>"]:::svc

      subgraph PXC2["Percona XtraDB Cluster B  ·  <cluster: ___>"]
      direction LR
        Q1["PXC-B-1<br/><i>pod: ___</i>"]:::pxc
        Q2["PXC-B-2<br/><i>pod: ___</i>"]:::pxc
        Q3["PXC-B-3<br/><i>pod: ___</i>"]:::pxc
        Q4["PXC-B-4<br/><i>pod: ___</i>"]:::pxc
        Q5["PXC-B-5<br/><i>pod: ___</i>"]:::pxc
        Q6["PXC-B-6<br/><i>pod: ___</i>"]:::pxc
      end

      STOR2["StorageClass / PV / PVC<br/><i>class: ___</i>"]:::storage
      BK2["PXCBackup / XtraBackup Job<br/><i>schedule: ___</i>"]:::backup
    end
  end

  %% ======= AWS (backups) =======
  subgraph AWS["AWS (Backups)"]
  direction TB
    S3A["S3 Bucket (A)<br/><i>arn: ___</i>"]:::s3
    S3B["S3 Bucket (B)<br/><i>arn: ___</i>"]:::s3
  end

  %% ======= Wiring =======
  OP1 --> PXC1
  OP2 --> PXC2

  SVC1 --> PROXY1 --> PXC1
  SVC2 --> PROXY2 --> PXC2

  PXC1 --- STOR1
  PXC2 --- STOR2

  BK1 --> PXC1
  BK2 --> PXC2

  %% Secure pipes to S3 (gentle dashed)
  BK1 -. "TLS + IAM · <endpoint: ___>" .-> S3A
  BK2 -. "TLS + IAM · <endpoint: ___>" .-> S3B

  %% Inter-DC secure replication (gentle dashed)
  PXC1 -. "Percona Replication (async) · TLS/VPN · <user: ___>" .-> PXC2
  PXC2 -. "Optional reverse repl (async)" .-> PXC1

  %% ======= Styles (pastels + transparency + round corners) =======
  classDef operator fill:#c7e3ff,fill-opacity:0.6,stroke:#7fb7ff,stroke-width:1.5px,color:#1d2733,rx:16,ry:16;
  classDef proxy    fill:#e7d9ff,fill-opacity:0.6,stroke:#c2a9ff,stroke-width:1.5px,color:#2a2038,rx:16,ry:16;
  classDef svc      fill:#dff6ee,fill-opacity:0.6,stroke:#a8e3cf,stroke-width:1.5px,color:#1f2b28,rx:16,ry:16;
  classDef pxc      fill:#ffe8d6,fill-opacity:0.7,stroke:#ffc9a3,stroke-width:1.5px,color:#2a241e,rx:12,ry:12;
  classDef storage  fill:#fff8cc,fill-opacity:0.7,stroke:#ffe27a,stroke-width:1.5px,color:#2e2913,rx:14,ry:14;
  classDef backup   fill:#fde2e4,fill-opacity:0.7,stroke:#f7b6bd,stroke-width:1.5px,color:#3a2225,rx:14,ry:14;
  classDef s3       fill:#e3f2ff,fill-opacity:0.6,stroke:#add6ff,stroke-width:1.5px,color:#1f2a33,rx:14,ry:14;

  %% Subgraph frames (soft borders + translucent fills)
  style DC1 stroke:#9fc5f8,stroke-width:2px,fill:#f5fbff,fill-opacity:0.5,color:#2b2b2b
  style DC2 stroke:#9fc5f8,stroke-width:2px,fill:#f5fbff,fill-opacity:0.5,color:#2b2b2b
  style AWS stroke:#a8e3cf,stroke-width:2px,fill:#f6fffb,fill-opacity:0.6,color:#2b2b2b

  style K8S1 stroke:#c2a9ff,stroke-width:1.5px,fill:#f7f3ff,fill-opacity:0.7,color:#2b2b2b
  style K8S2 stroke:#c2a9ff,stroke-width:1.5px,fill:#f7f3ff,fill-opacity:0.7,color:#2b2b2b

