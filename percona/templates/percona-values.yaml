pxc:
  size: {{NODES}}
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1
  persistence:
    enabled: true
    size: 20Gi
    accessMode: ReadWriteOnce
    storageClass: gp3
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/component
            operator: In
            values:
            - pxc
        topologyKey: topology.kubernetes.io/zone
  podDisruptionBudget:
    maxUnavailable: 1
haproxy:
  enabled: false
proxysql:
  enabled: true
  size: {{NODES}}
  image: percona/proxysql2:2.7.3
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m
  affinity:
    podAntiAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/component
            operator: In
            values:
            - proxysql
        topologyKey: topology.kubernetes.io/zone
  podDisruptionBudget:
    maxUnavailable: 1
  volumeSpec:
    persistentVolumeClaim:
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 5Gi
      storageClassName: gp3
backup:
  enabled: true
  pitr:
    enabled: true
    storageName: minio-backup
    timeBetweenUploads: 60
  storages:
    minio-backup:
      type: s3
      s3:
        bucket: percona-backups
        region: us-east-1
        endpointUrl: http://minio.minio.svc.cluster.local:9000
        forcePathStyle: true
        credentialsSecret: percona-backup-minio-credentials
  schedule:
    - name: "daily-backup"
      schedule: "0 2 * * *"
      retention:
        type: "count"
        count: 7
        deleteFromStorage: true
      storageName: minio-backup
    - name: "weekly-backup"
      schedule: "0 1 * * 0"
      retention:
        type: "count"
        count: 8
        deleteFromStorage: true
      storageName: minio-backup
    - name: "monthly-backup"
      schedule: "30 1 1 * *"
      retention:
        type: "count"
        count: 12
        deleteFromStorage: true
      storageName: minio-backup

