# Fleet Configuration for PMM with Custom Alerts
#
# This deploys PMM with custom alert rules and PagerDuty notifications
# Alert rules and notification configs are git-managed via ConfigMaps
---
defaultNamespace: pmm

# Create ConfigMaps for alerts and notifications
resources:
  - pmm-alerts.yaml
  - pmm-notifications.yaml

# Deploy PMM Helm chart with custom values
helm:
  repo: https://percona.github.io/percona-helm-charts/
  chart: pmm
  releaseName: pmm
  
  # Base values for all environments
  valuesFiles:
    - values/pmm-base.yaml
  
  # Environment-specific overrides
  targetCustomizations:
    - name: dev
      clusterSelector:
        matchLabels:
          environment: development
      helm:
        valuesFiles:
          - values/pmm-dev.yaml
    
    - name: staging
      clusterSelector:
        matchLabels:
          environment: staging
      helm:
        valuesFiles:
          - values/pmm-staging.yaml
    
    - name: prod
      clusterSelector:
        matchLabels:
          environment: production
      helm:
        valuesFiles:
          - values/pmm-prod.yaml
